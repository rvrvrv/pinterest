'use strict';var path=process.cwd(),ClickHandler=require(path+'/app/controllers/clickHandler.server');module.exports=function(a,b){function c(a,b,c){if(console.log('req.session at isLoggedIn: ',a.session),a.session.passport===a.session.userId)return c()}var d=new ClickHandler;a.get('/',function(a,b){b.sendFile(path+'/public/index.html')}),a.get('/logout',function(a,b){a.session.reset(),b.redirect('/')}),a.get('/auth/twitter',b.authenticate('twitter')),a.get('/auth/twitter/callback',function(a,c,d){b.authenticate('twitter',function(b,e){return b?d(b):e?void a.logIn(e,function(b){return b?d(b):void(a.session.passport=e.id,a.session.userId=e.id,a.session.userName=e.name,c.redirect('/'))}):c.send('error')})(a,c,d)}),a.route('/api/allpins/').get(function(a,b){return d.getAllPins(a,b)}),a.get('/api/:id?',c,function(a,b){d.loadUser(a,b)}),a.route('/api/like/:obj').put(c,function(a,b){return d.likePin(a.session.userId,a.params.obj,b)}).delete(c,function(a,b){return d.unlikePin(a.session.userId,a.params.obj,b)}),a.route('/api/pin/:pinUrl/:pinCaption?').post(c,function(a,b){return d.addToCollection(a,b)}).put(c,function(a,b){return d.addPin(a.session,decodeURIComponent(a.params.pinUrl),decodeURIComponent(a.params.pinCaption),b)}).delete(c,function(a,b){return d.delPin(a.session,decodeURIComponent(a.params.pinUrl),b)})};