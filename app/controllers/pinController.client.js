'use strict';var lastUrl;function filterPins(a){$('.pins').isotope({filter:a})}function generatePin(a,b,c,d,e,f,g){var h,i,j;f?(h='grid-item yours',i=generateDelBtn(a,b,c),j=''):(h='grid-item',i='<span class="left">\n                        <a class="tooltipped" data-caption="'+b+'" \n                        data-owner="'+c+'" data-url="'+a+'" \n                        data-tooltip="View all pins by '+d+'">\n                        '+d+'</a>\n                    </span>',j='errorMsg(\'Please log in to like '+b+'\')');var k='<div class="'+h+'" data-owner="'+c+'" data-url="'+a+'">\n                    <img src="'+a+'" alt="'+b+'" data-owner-name="'+d+'"\n                    onerror="this.onerror=null;this.src=\'../public/img/badImg.jpg\';">\n                    <h6 class="center">'+b+'</h6>\n                        <h6>\n                            '+i+'\n                            <span class="right">\n                                <a class="dynLink tooltipped" data-link="like" data-owner="'+c+'" data-url="'+a+'" \n                                data-tooltip="Like this pin" onclick="'+j+'">\n                                <i class="fa fa-heart-o"></i>&nbsp;</a>\n                                <span class="likes">'+e+'</span>\n                            </span>\n                        </h6>\n                    </div>';return g?void($('.pins').isotope('insert',$(k)),$('.tooltipped').tooltip(),$('img[data-owner="'+c+'"][data-url="'+a+'"]').click(function(){bigImg($(this))}),$('a[data-owner="'+c+'"][data-url="'+a+'"]').click(function(){likePin(this)})):k}function generateDelBtn(a,b,c){return'<span class="left">\n                <a class="tooltipped" data-caption="'+b+'" \n                data-owner="'+c+'" data-url="'+a+'" \n                onclick="deletePin(this)" data-tooltip="Delete this pin">\n                <i class="fa fa-minus-square-o"></i></a>\n            </span>'}function badImg(a){$('#newPinImg').attr('src','../public/img/badImg.jpg'),errorMsg('No image found at \''+a+'\''),$('#newPinUrl').removeClass('valid').addClass('invalid'),lastUrl=!1}function updateImg(){var a=$('#newPinUrl');if(''!==a.val()){var b=a.val().trim();b.toLowerCase().startsWith('http')||(b='https://'+b),a.val(b),b!==lastUrl&&($('#newPinImg').attr('src',b),lastUrl=b)}}function savePin(){var a=$('#newPinCaption').val();if(!a||$('#newPinCaption').hasClass('invalid'))return errorMsg('Please enter a valid caption for your pin.');if(!lastUrl)return errorMsg('Please enter a valid image URL.');var b=$('#saveBtn');b.html('<i class="fa fa-circle-o-notch fa-spin fa-3x"></i>'),b.addClass('disabled'),setTimeout(function(){lastUrl&&$('#modalConfirmSave').modal('open'),b.html('Save Pin'),b.removeClass('disabled')},500)}function performSave(){var a=$('#newPinCaption'),b=$('#newPinUrl');if(a.hasClass('invalid')||b.hasClass('invalid'))return $('#modalConfirmSave').modal('close');progress('show',!0),$('#modalConfirmSave a').addClass('disabled'),$('#modalConfirmSave h5').html('Saving...');var c='/api/pin/'+encodeURIComponent(b.val())+'/'+encodeURIComponent(a.val());ajaxFunctions.ajaxRequest('PUT',c,function(c){if($('#modalConfirmSave').modal('close'),setTimeout(function(){$('#modalConfirmSave a').removeClass('disabled'),$('#modalConfirmSave h5').html('Are you sure you would like to save this pin?')},1e3),progress('hide',!0),'error'===c)return errorMsg();if('exists'===c)return errorMsg('You\'ve already pinned this image!');resetPinModal();var d=JSON.parse(c);generatePin(b.val(),a.val(),d.ownerId,d.ownerName,0,!0,!0),Materialize.toast('New pin saved!',3e3)})}function resetPinModal(){$('#modal-newPin').modal('close'),setTimeout(function(){$('input').val(''),$('input').removeClass('invalid valid'),$('#newPinImg').attr('src','../public/img/galaxy.jpg')},1e3),lastUrl=''}function deletePin(a){$('#delMsg').html('Are you sure you want to delete '+$(a).data('caption')+'?'),$('#confirmDelBtn').unbind('click'),$('#confirmDelBtn').click(function(){return performDelete($(a).data('url'))}),$('#modalConfirmDelete').modal('open')}function performDelete(a){ajaxFunctions.ajaxRequest('DELETE','/api/pin/'+encodeURIComponent(a),function(b){return'error'===b?errorMsg():'no'===b?errorMsg('That isn\'t your pin!'):void($('#modalConfirmDelete').modal('close'),Materialize.toast('Your pin has been deleted!',3e3),$('.pins').isotope('remove',$('.grid-item[data-owner="'+b+'"][data-url="'+a+'"]')))})}