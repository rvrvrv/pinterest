'use strict';var TwitterStrategy=require('passport-twitter').Strategy,mongoose=require('mongoose'),User=require('../models/users'),configAuth=require('./auth');module.exports=function(a){a.serializeUser(function(a,b){return b(null,a.id)}),a.deserializeUser(function(a,b){var c=mongoose.Schema.Types.ObjectId(a);User.findById(c,function(a,c){b(a,c)})}),a.use(new TwitterStrategy({consumerKey:configAuth.twitterAuth.consumerKey,consumerSecret:configAuth.twitterAuth.consumerSecret,callbackURL:configAuth.twitterAuth.callbackURL},function(a,b,c,d){process.nextTick(function(){User.findOne({id:c.id},function(a,b){if(a)return d(a);if(b)return d(null,b);var e=new User;return e.id=c.id,e.name=c.displayName,e.img=c.photos[0].value,e.save(function(a){if(a)throw a;return d(null,e)})})})}))};