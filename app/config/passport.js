const TwitterStrategy=require("passport-twitter").Strategy,mongoose=require("mongoose"),User=require("../models/users"),configAuth=require("./auth");module.exports=function(a){a.serializeUser((a,b)=>b(null,a.id)),a.deserializeUser((a,b)=>{const c=mongoose.Schema.Types.ObjectId(a);User.findById(c,(a,c)=>{b(a,c)})}),a.use(new TwitterStrategy({consumerKey:configAuth.twitterAuth.consumerKey,consumerSecret:configAuth.twitterAuth.consumerSecret,callbackURL:configAuth.twitterAuth.callbackURL},(a,b,c,d)=>{process.nextTick(()=>{User.findOne({id:c.id},(a,b)=>{if(a)return d(a);if(b)return d(null,b);const e=new User;return e.id=c.id,e.name=c.displayName,e.img=c.photos[0].value,e.save(a=>{if(a)throw a;return d(null,e)})})})}))};